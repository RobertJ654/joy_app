{% extends 'base.html' %}

{% block title %}Test{% endblock %}

{% block head %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encuesta de Control - STAI</title>
    <style>
        /* Estilos específicos para esta página o que sobreescriben los de base.html */
        .container {
            display: flex;
            width: 100%;
        }
        .sidebar {
            width: 30%;
            background-color: #fff;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-right: 1px solid #ddd;
            position: sticky;
            top: 0;
            height: 100vh; /* Asegúrate de que el sidebar tenga la altura suficiente */
            justify-content: flex-start; /* Para que el contenido sticky se vea desde arriba */
        }
        .logo {
            text-align: center;
            margin-bottom: 20px;
            margin-top: 45%;
        }
        .logo h1 {
            color: #00c4b4;
            font-size: 2em;
            margin: 0;
        }
        .logo p {
            color: #00c4b4;
            font-size: 0.8em;
            margin: 5px 0 0;
        }
        .robot {
            text-align: center;
        }
        .robot p {
            background-color: #e0f7fa;
            color: #00c4b4;
            padding: 10px;
            border-radius: 20px;
            display: inline-block;
        }
        .main {
            width: 70%;
            padding: 20px;
            background-color: #fff;
            overflow-y: auto;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .header h2 {
            color: #00c4b4;
            font-size: 2em;
            margin: 0;
        }
        .header p {
            background-color: #e0f7fa;
            color: #00c4b4;
            padding: 5px 10px;
            border-radius: 20px;
            display: inline-block;
            margin: 10px 0;
        }
        .question {
            margin-bottom: 15px;
        }
        .question p {
            margin: 5px 0;
        }
        .question select {
            width: 100%;
            padding: 0.75rem; /* Usando la misma unidad que Bootstrap */
            background-color: #00c4b4;
            color: #fff;
            border: none;
            border-radius: 0.25rem; /* Usando la misma unidad que Bootstrap */
            font-size: 1em;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=utf-8,%3Csvg xmlns%3D"http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" viewBox%3D"0 0 16 16"%3E%3Cpath fill%3D"%23fff" d%3D"M1.5 5.5a.5.5 0 0 1 .5-.5h12a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5zM8 8.5a.5.5 0 0 0-.5.5v2a.5.5 0 0 0 1 0V9a.5.5 0 0 0-.5-.5z"/%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 16px 12px;
        }
        .submit-btn {
            display: block;
            width: 100%;
            padding: 0.75rem; /* Usando la misma unidad que Bootstrap */
            background-color: #00c4b4;
            color: #fff;
            border: none;
            border-radius: 0.25rem; /* Usando la misma unidad que Bootstrap */
            font-size: 1em;
            cursor: pointer;
            text-align: center;
        }
        .submit-btn:hover {
            background-color: #00a799;
        }
        .result {
            margin-top: 20px;
            padding: 1rem; /* Usando la misma unidad que Bootstrap */
            background-color: #e0f7fa;
            border-radius: 0.25rem; /* Usando la misma unidad que Bootstrap */
            display: none;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="container">
        <div class="sidebar">
            <div class="logo">
                <h1>JOY</h1>
                <p>NEUROSCIENCE ANALYSIS</p>
            </div>
            <div class="robot">
                <p>¡HOLA MÓNICA!</p>
            </div>
        </div>
        <div class="main">
            <div class="header">
                <h2>ENCUESTA DE CONTROL</h2>
                <p>HOLA MÓNICA</p>
            </div>
            <form action="save_results.php" method="POST" id="staiForm">
                <div class="question">
                    <p>1. Me siento calmado</p>
                    <select name="q1" id="q1" class="form-select">
                        <option value="0">Nada</option>
                        <option value="1">Algo</option>
                        <option value="2">Bastante</option>
                        <option value="3">Mucho</option>
                    </select>
                </div>
                <div class="question">
                    <p>2. Me siento seguro</p>
                    <select name="q2" id="q2" class="form-select">
                        <option value="0">Nada</option>
                        <option value="1">Algo</option>
                        <option value="2">Bastante</option>
                        <option value="3">Mucho</option>
                    </select>
                </div>
                <div class="question">
                    <p>3. Estoy tenso</p>
                    <select name="q3" id="q3" class="form-select">
                        <option value="0">Nada</option>
                        <option value="1">Algo</option>
                        <option value="2">Bastante</option>
                        <option value="3">Mucho</option>
                    </select>
                </div>
                <div class="question">
                    <p>4. Estoy contrariado</p>
                    <select name="q4" id="q4" class="form-select">
                        <option value="0">Nada</option>
                        <option value="1">Algo</option>
                        <option value="2">Bastante</option>
                        <option value="3">Mucho</option>
                    </select>
                </div>
                <div class="question">
                    <p>5. Me siento cómodo (estoy a gusto)</p>
                    <select name="q5" id="q5" class="form-select">
                        <option value="0">Nada</option>
                        <option value="1">Algo</option>
                        <option value="2">Bastante</option>
                        <option value="3">Mucho</option>
                    </select>
                </div>
                <div class="question">
                    <p>6. Me siento alterado</p>
                    <select name="q6" id="q6" class="form-select">
                        <option value="0">Nada</option>
                        <option value="1">Algo</option>
                        <option value="2">Bastante</option>
                        <option value="3">Mucho</option>
                    </select>
                </div>
                <div class="question">
                    <p>7. Estoy preocupado ahora por posibles desgracias futuras</p>
                    <select name="q7" id="q7" class="form-select">
                        <option value="0">Nada</option>
                        <option value="1">Algo</option>
                        <option value="2">Bastante</option>
                        <option value="3">Mucho</option>
                    </select>
                </div>
                <div class="question">
                    <p>8. Me siento descansado</p>
                    <select name="q8" id="q8" class="form-select">
                        <option value="0">Nada</option>
                        <option value="1">Algo</option>
                        <option value="2">Bastante</option>
                        <option value="3">Mucho</option>
                    </select>
                </div>
                <div class="question">
                    <p>9. Me siento angustiado</p>
                    <select name="q9" id="q9" class="form-select">
                        <option value="0">Nada</option>
                        <option value="1">Algo</option>
                        <option value="2">Bastante</option>
                        <option value="3">Mucho</option>
                    </select>
                </div>
                <div class="question">
                    <p>10. Me siento confortable</p>
                    <select name="q10" id="q10" class="form-select">
                        <option value="0">Nada</option>
                        <option value="1">Algo</option>
                        <option value="2">Bastante</option>
                        <option value="3">Mucho</option>
                    </select>
                </div>
                <div class="question">
                    <p>11. Tengo confianza en mí mismo</p>
                    <select name="q11" id="q11" class="form-select">
                        <option value="0">Nada</option>
                        <option value="1">Algo</option>
                        <option value="2">Bastante</option>
                        <option value="3">Mucho</option>
                    </select>
                </div>
                <div class="question">
                    <p>12. Me siento nervioso</p>
                    <select name="q12" id="q12" class="form-select">
                        <option value="0">Nada</option>
                        <option value="1">Algo</option>
                        <option value="2">Bastante</option>
                        <option value="3">Mucho</option>
                    </select>
                </div>
                <div class="question">
                    <p>13. Estoy desasosegado</p>
                    <select name="q13" id="q13" class="form-select">
                        <option value="0">Nada</option>
                        <option value="1">Algo</option>
                        <option value="2">Bastante</option>
                        <option value="3">Mucho</option>
                    </select>
                </div>
                <div class="question">
                    <p>14. Me siento muy «atado» (como oprimido)</p>
                    <select name="q14" id="q14" class="form-select">
                        <option value="0">Nada</option>
                        <option value="1">Algo</option>
                        <option value="2">Bastante</option>
                        <option value="3">Mucho</option>
                    </select>
                </div>
                <div class="question">
                    <p>15. Estoy relajado</p>
                    <select name="q15" id="q15" class="form-select">
                        <option value="0">Nada</option>
                        <option value="1">Algo</option>
                        <option value="2">Bastante</option>
                        <option value="3">Mucho</option>
                    </select>
                </div>
                <div class="question">
                    <p>16. Me siento satisfecho</p>
                    <select name="q16" id="q16" class="form-select">
                        <option value="0">Nada</option>
                        <option value="1">Algo</option>
                        <option value="2">Bastante</option>
                        <option value="3">Mucho</option>
                    </select>
                </div>
                <div class="question">
                    <p>17. Estoy preocupado</p>
                    <select name="q17" id="q17" class="form-select">
                        <option value="0">Nada</option>
                        <option value="1">Algo</option>
                        <option value="2">Bastante</option>
                        <option value="3">Mucho</option>
                    </select>
                </div>
                <div class="question">
                    <p>18. Me siento aturdido y sobreexcitado</p>
                    <select name="q18" id="q18" class="form-select">
                        <option value="0">Nada</option>
                        <option value="1">Algo</option>
                        <option value="2">Bastante</option>
                        <option value="3">Mucho</option>
                    </select>
                </div>
                <div class="question">
                    <p>19. Me siento alegre</p>
                    <select name="q19" id="q19" class="form-select">
                        <option value="0">Nada</option>
                        <option value="1">Algo</option>
                        <option value="2">Bastante</option>
                        <option value="3">Mucho</option>
                    </select>
                </div>
                <div class="question">
                    <p>20. En este momento me siento bien</p>
                    <select name="q20" id="q20" class="form-select">
                        <option value="0">Nada</option>
                        <option value="1">Algo</option>
                        <option value="2">Bastante</option>
                        <option value="3">Mucho</option>
                    </select>
                </div>
                <input type="hidden" name="user_id" value="1">
                <button type="submit" class="submit-btn">ENVIAR</button>
            </form>
            <div class="result" id="result"></div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        document.getElementById('staiForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const positiveItems = [1, 2, 5, 8, 10, 11, 15, 16, 19, 20];
            const negativeItems = [3, 4, 6, 7, 9, 12, 13, 14, 17, 18];
            let stateScore = 0;

            // Calculate state score
            positiveItems.forEach(item => {
                const score = parseInt(document.getElementById(`q${item}`).value);
                stateScore += score;
            });
            negativeItems.forEach(item => {
                const score = parseInt(document.getElementById(`q${item}`).value);
                const reversedScore = 3 - score;
                stateScore += reversedScore;
            });

            // Set state score in form
            const stateInput = document.createElement('input');
            stateInput.type = 'hidden';
            stateInput.name = 'state_score';
            stateInput.value = stateScore;
            this.appendChild(stateInput);

            // Set trait score (placeholder as 0 for now)
            const traitInput = document.createElement('input');
            traitInput.type = 'hidden';
            traitInput.name = 'trait_score';
            traitInput.value = 0;
            this.appendChild(traitInput);

            // Submit form
            this.submit();
        });
    </script>
{% endblock %}